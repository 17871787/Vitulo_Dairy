// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String?
  role         UserRole
  farmId       String?
  farm         Farm?    @relation(fields: [farmId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Farm {
  id             String         @id @default(cuid())
  name           String
  type           FarmType
  location       String?
  users          User[]
  animals        Animal[]       @relation("CurrentFarm")
  suppliedCalves Animal[]       @relation("SourceFarm")
  calfPurchases  CalfPurchase[] @relation("SourceFarm")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Animal {
  id            String        @id @default(cuid())
  tagNumber     String        @unique
  breed         Breed
  sex           Sex
  dateOfBirth   DateTime
  status        AnimalStatus
  sourceFarmId  String?
  sourceFarm    Farm?         @relation("SourceFarm", fields: [sourceFarmId], references: [id])
  currentFarmId String?
  currentFarm   Farm?         @relation("CurrentFarm", fields: [currentFarmId], references: [id])
  calfPurchase  CalfPurchase?
  killRecord    KillRecord?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model CalfPurchase {
  id             String         @id @default(cuid())
  animalId       String         @unique
  animal         Animal         @relation(fields: [animalId], references: [id])
  purchasePrice  Decimal        @db.Decimal(10, 2)
  purchaseDate   DateTime
  purchaseWeight Decimal?       @db.Decimal(10, 2)
  sourceFarmId   String?
  sourceFarm     Farm?          @relation("SourceFarm", fields: [sourceFarmId], references: [id])
  transferValue  Decimal?       @db.Decimal(10, 2)
  transferDate   DateTime?
  finisherFarmId String?
  importedFrom   String?
  paymentStatus  PaymentStatus?
  paymentDate    DateTime?
  invoiceNumber  String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model KillRecord {
  id                String   @id @default(cuid())
  animalId          String   @unique
  animal            Animal   @relation(fields: [animalId], references: [id])
  dateOfKill        DateTime
  deadweight        Decimal  @db.Decimal(10, 2)
  fatClass          String
  conformationClass String
  carcassValue      Decimal  @db.Decimal(10, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// Enums
enum UserRole {
  ADMIN
  VITULO_STAFF
  DAIRY_SUPPLIER
  FINISHER
}

enum FarmType {
  DAIRY_SUPPLIER
  FINISHER
  VITULO_OWNED
}

enum Breed {
  ANGUS
  HEREFORD
  SIMMENTAL
  CHAROLAIS
  LIMOUSIN
  ABERDEEN_ANGUS
  AAX // Aberdeen Angus Cross
  BBX // British Blue Cross
  HEX // Hereford Cross
  OTHER
}

enum Sex {
  MALE
  FEMALE
  CASTRATED
}

enum AnimalStatus {
  ALIVE
  SLAUGHTERED
  SOLD
  DEAD
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
}
